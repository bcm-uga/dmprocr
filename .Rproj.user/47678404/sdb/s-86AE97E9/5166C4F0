{
    "collab_server" : "",
    "contents" : "#' getDifferentialTable\n#'\n#' Generate differential methylation data table from beta values. It basically extract all tumorous samples and controls. Then it computes the difference between each tumorous and the mean of control\n#'\n#' @param data A matrix of row methylation data with TCGA sample ids as column names and probes ids as row names\n#' @param platform a dataframe with metadata types as columns names and probes ids as row names\n#' @param exp_group a dataframe of metadata about the samples. Rows are ids and columns information type.\n#'\n#' @export  \n#' @examples\n#' library(gsubfn)\n#' ###generate random samples ids  \n#' regexTum <- \"^TCGA-.{2}-.{4}-01.{1}-.{3}-.{4}-.{2}$\"\n#' regexWT <- \"^TCGA-.{2}-.{4}-11.{1}-.{3}-.{4}-.{2}$\"\n#'\n#' sampleId <- c(\n#'          sapply(1:6, function(x) {\n#'              gsub(\"\\\\^|\\\\$\", \"\",\n#'              gsubfn(\"\\\\.{([[:digit:]]+)}\",\n#'              ~ paste(rep(sample(c(LETTERS, 1:9), 1), n), collapse=\"\"), regexTum)) }),\n#'          sapply(1:4, function(x) {\n#'              gsub(\"\\\\^|\\\\$\", \"\",\n#'              gsubfn(\"\\\\.{([[:digit:]]+)}\", \n#'              ~ paste(rep(sample(c(LETTERS, 1:9), 1), n), collapse=\"\"), regexWT)) })\n#'              )\n#' idProbes <- paste0(rep(\"probe\", 10), 1:10) \n#' data <- matrix(runif(100,0,1), 10, 10)\n#' colnames(data) <- sampleId\n#' rownames(data) <- idProbes\n#'\n#' ###generate exp_group\n#' exp_group <- as.data.frame(matrix(rep(1, 50),  10, 5), row.names = sampleId) \n#'\n#' ###generate platfrom\n#' platform  <-as.data.frame(matrix(rep(1, 50),  10, 5), row.names = idProbes)\n#' diff_table <- getDifferentialTable(data, platform, exp_group)\n\n\n\ngetDifferentialTable <- function(data, platform, exp_group){\n  \n  ## get the names of ind by type\n  TumoralRef       <- grep(\"^TCGA-.{2}-.{4}-01.{1}-.{3}-.{4}-.{2}$\", colnames(data), perl = TRUE  ,value = TRUE)\n  ControlRef       <- grep(\"^TCGA-.{2}-.{4}-11.{1}-.{3}-.{4}-.{2}$\", colnames(data), value = TRUE)\n  OthersRef        <- grep(\"^TCGA-.{2}-.{4}-02\", colnames(data), value = TRUE)\n  \n  #delete row all na\n  ind                 <- apply(data, 1, function(x) all(is.na(x)))\n  data      <- data[!ind, ]\n  platform  <- platform[!ind, ]  \n  \n  \n  #compute the mean of Control\n  meanControl         <- rowMeans(data[, ControlRef], na.rm = TRUE)\n  \n  \n  #keep only tum samples in data, exp_group...\n  data      <- data[, which(colnames(data) %in% TumoralRef)]\n  exp_group <- exp_group[which(rownames(exp_group) %in% TumoralRef), ] \n  platform  <- platform[!ind, ]\n  \n  #Perfom differential methylation\n  list  <- lapply(colnames(data), function(x){\n    data[, x] - meanControl\n  })\n  \n  AllDM               <- do.call(cbind, list)\n  AllDM               <- as.data.frame(AllDM)\n  colnames(AllDM)     <- colnames(data)\n  rownames(AllDM)     <- rownames(data)\n  \n  \n  #delete list 'cause it's heavy\n  rm(list)\n  \n  \n  #check dimensions constraints\n  dim(AllDM)\n  dim(exp_group)\n  dim(platform)\n  \n  #And return a list of object\n  met_studyAllMean    <- list(data = AllDM, exp_group = exp_group, platform = platform)\n  \n  return(met_studyAllMean)\n  \n}\n",
    "created" : 1497346062306.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1097592333",
    "id" : "5166C4F0",
    "lastKnownWriteTime" : 1497606871,
    "last_content_update" : 1497606871731,
    "path" : "~/dmprocr/R/getDifferentialTable.R",
    "project_path" : "R/getDifferentialTable.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}